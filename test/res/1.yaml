AWSTemplateFormatVersion: 2010-09-09
Parameters:
    OrgName:
        Type: String
        Default: My Organisation
    OrgDomain:
        Type: String
Resources:
    ZONE:
        Type: AWS::Route53::HostedZone
        Properties:
            Name: mydomain.com


    DbUsers:
        Type: AWS::DynamoDB::Table
        Properties:
            TableName: users
            BillingMode: PAY_PER_REQUEST
            AttributeDefinitions:
                -
                  AttributeName: user_id
                  AttributeType: S
                -
                  AttributeName: username
                  AttributeType: S
                -
                  AttributeName: email
                  AttributeType: S
                -
                  AttributeName: preferred_username
                  AttributeType: S

            KeySchema:
                -
                  AttributeName: user_id
                  KeyType: HASH
            ProvisionedThroughput:
                ReadCapacityUnits: 1
                WriteCapacityUnits: 1
            GlobalSecondaryIndexes:
                -
                    IndexName: username
                    Projection:
                        ProjectionType: ALL
                    KeySchema:
                        -
                            AttributeName: username
                            KeyType: HASH
                    ProvisionedThroughput:
                        ReadCapacityUnits: 1
                        WriteCapacityUnits: 1
                -
                    IndexName: email
                    Projection:
                        ProjectionType: ALL
                    KeySchema:
                        -
                            AttributeName: email
                            KeyType: HASH
                    ProvisionedThroughput:
                        ReadCapacityUnits: 1
                        WriteCapacityUnits: 1
                -
                    IndexName: preferred_username
                    Projection:
                        ProjectionType: ALL
                    KeySchema:
                        -
                            AttributeName: preferred_username
                            KeyType: HASH
                    ProvisionedThroughput:
                        ReadCapacityUnits: 1
                        WriteCapacityUnits: 1
    DbSessions:
        Type: AWS::DynamoDB::Table
        Properties:
            TableName: sessions
            BillingMode: PAY_PER_REQUEST
            AttributeDefinitions:
                -
                  AttributeName: session_id
                  AttributeType: S

            KeySchema:
                -
                  AttributeName: session_id
                  KeyType: HASH
            ProvisionedThroughput:
                ReadCapacityUnits: 1
                WriteCapacityUnits: 1
            TimeToLiveSpecification:
                AttributeName: expire_at
                Enabled: true
            StreamSpecification:
                StreamEnabled: true,
                StreamViewType: NEW_AND_OLD_IMAGES



    DbPhotos:
        Type: AWS::DynamoDB::Table
        Properties:
            TableName: photos
            BillingMode: PAY_PER_REQUEST
            AttributeDefinitions:
                -
                  AttributeName: user_id
                  AttributeType: S
                -
                  AttributeName: photo_id
                  AttributeType: S


                -
                  AttributeName: album_id
                  AttributeType: S
                -
                  AttributeName: uploaded_at
                  AttributeType: N

            KeySchema:
                -
                  AttributeName: user_id
                  KeyType: HASH
                -
                  AttributeName: photo_id
                  KeyType: RANGE
            ProvisionedThroughput:
                ReadCapacityUnits: 4
                WriteCapacityUnits: 1
            GlobalSecondaryIndexes:
                -
                    IndexName: album_id
                    Projection:
                        ProjectionType: ALL
                    KeySchema:
                        -
                            AttributeName: album_id
                            KeyType: HASH
                        -
                            AttributeName: uploaded_at
                            KeyType: RANGE
                    ProvisionedThroughput:
                        ReadCapacityUnits: 1
                        WriteCapacityUnits: 1
